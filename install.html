<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Appendix A: Getting Started: Installing LLVM and the Cpu0 example code &mdash; Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Tutorial: Creating an LLVM Backend for the Cpu0 Architecture" href="index.html" />
    <link rel="next" title="Appendix B: Cpu0 document and test" href="doc.html" />
    <link rel="prev" title="Verify backend on Verilog simulator" href="verilog.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>Appendix A: Getting Started: Installing LLVM and the Cpu0 example code</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="verilog.html">Verify backend on Verilog simulator</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="doc.html">Appendix B: Cpu0 document and test</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="appendix-a-getting-started-installing-llvm-and-the-cpu0-example-code">
<span id="sec-appendix-installing"></span><h1>Appendix A: Getting Started: Installing LLVM and the Cpu0 example code<a class="headerlink" href="#appendix-a-getting-started-installing-llvm-and-the-cpu0-example-code" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#setting-up-your-mac" id="id19">Setting Up Your Mac</a><ul>
<li><a class="reference internal" href="#installing-xcode-and-cmake" id="id20">Installing Xcode and cmake</a></li>
<li><a class="reference internal" href="#install-icarus-verilog-tool-on-imac" id="id21">Install Icarus Verilog tool on iMac</a></li>
<li><a class="reference internal" href="#install-other-tools-on-imac" id="id22">Install other tools on iMac</a></li>
<li><a class="reference internal" href="#installing-clang" id="id23">Installing clang</a></li>
<li><a class="reference internal" href="#create-llvm-xcodeproj-by-terminal-cmake-command" id="id24">Create LLVM.xcodeproj by terminal cmake command</a></li>
<li><a class="reference internal" href="#build-llvm-by-xcode" id="id25">Build llvm by Xcode</a></li>
<li><a class="reference internal" href="#create-llvm-xcodeproj-of-supporting-cpu0-by-terminal-cmake-command" id="id26">Create LLVM.xcodeproj of supporting Cpu0 by terminal cmake command</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-up-your-linux-machine" id="id27">Setting Up Your Linux Machine</a><ul>
<li><a class="reference internal" href="#install-icarus-verilog-tool-on-linux" id="id28">Install Icarus Verilog tool on Linux</a></li>
<li><a class="reference internal" href="#install-other-tools-on-linux" id="id29">Install other tools on Linux</a></li>
<li><a class="reference internal" href="#install-llvm-3-7-release-build-on-linux" id="id30">Install LLVM 3.7 release build on Linux</a></li>
<li><a class="reference internal" href="#install-cpu0-debug-build-on-linux" id="id31">Install Cpu0 debug build on Linux</a></li>
</ul>
</li>
</ul>
</div>
<p>Cpu0 example code, lbdex, can be found at near left bottom of this web site. Or
here <a class="reference external" href="http://jonathan2251.github.io/lbd/lbdex.tar.gz">http://jonathan2251.github.io/lbd/lbdex.tar.gz</a>.</p>
<p>In this chapter, we will run through how to set up LLVM using if you are using
Mac OS X or Linux.
For information on using <code class="docutils literal"><span class="pre">cmake</span></code> to build LLVM, please refer to the &#8220;Building
LLVM with CMake&#8221; <a class="footnote-reference" href="#llvm-cmake" id="id1">[1]</a> documentation for further information.</p>
<p>We will install two llvm directories in this chapter. One is the directory
~/llvm/release/ which contains the clang and clang++ compiler we will use to
translate the C/C++ input file into llvm IR.
The other is the directory ~/llvm/test/ which contains our cpu0 backend
program without clang and clang++.</p>
<p>This chapter details the installation of related software for this book.
If you are know well in llvm/clang installation or think it is too details, you
can run the bash script files after you install the Xcode and cmake as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-78-111:test Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/test
118-165-78-111:test Jonathan$ cp /Users/Jonathan/Downloads/
lbdex.tar.gz .
118-165-78-111:test Jonathan$ tar -zxvf lbdex.tar.gz
118-165-78-111:test Jonathan$ <span class="nb">cd</span> lbdex/install_llvm
118-165-78-111:install_llvm Jonathan$ ls
build-llvm-lbdex.sh   get-llvm.sh
118-165-78-111:install_llvm Jonathan$ bash get-llvm.sh
...
118-165-78-111:install_llvm Jonathan$ bash build-llvm-lbdex.sh
...
</pre></div>
</div>
<p>The contents of these two script files as follows,</p>
<p class="rubric">lbdex/install_llvm/get-llvm.sh</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

export VERSION=3.7.0

# Download address can be gotten from &quot;Copy link location&quot; of right clicking 
# mouse on firefox browser on llvm.org download page.
curl -O http://llvm.org/releases/${VERSION}/llvm-${VERSION}.src.tar.xz
curl -O http://llvm.org/releases/${VERSION}/cfe-${VERSION}.src.tar.xz

</pre></div>
</div>
<p class="rubric">lbdex/install_llvm/build-llvm-lbdex.sh</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

export VERSION=3.7.0
export LLVM_DIR=~/llvm
export LLVM_RELEASE_DIR=${LLVM_DIR}/release
export LLVM_TEST_DIR=${LLVM_DIR}/test

if ! test -d ${LLVM_DIR}; then
  mkdir ${LLVM_DIR}
fi

if [ -e /proc/cpuinfo ]; then
    export procs=`cat /proc/cpuinfo | grep processor | wc -l`
else
    export procs=1
fi

if ! test -d ${LLVM_RELEASE_DIR}; then
  mkdir ${LLVM_RELEASE_DIR}
  tar -xf llvm-${VERSION}.src.tar.xz -C ${LLVM_RELEASE_DIR}
  mv ${LLVM_RELEASE_DIR}/llvm-${VERSION}.src ${LLVM_RELEASE_DIR}/src
  tar -xf cfe-${VERSION}.src.tar.xz -C ${LLVM_RELEASE_DIR}/src/tools
  mv ${LLVM_RELEASE_DIR}/src/tools/cfe-${VERSION}.src \
  ${LLVM_RELEASE_DIR}/src/tools/clang
  mkdir ${LLVM_RELEASE_DIR}/cmake_release_build
  pushd ${LLVM_RELEASE_DIR}/cmake_release_build
  OS=`uname -s`
  echo &quot;OS =&quot; ${OS}
  if [ &quot;$OS&quot; == &quot;Linux&quot; ]; then
    cmake -DCMAKE_BUILD_TYPE=Release -G &quot;Unix Makefiles&quot; ../src
    make -j$procs -l$procs
  else [ &quot;$OS&quot; == &quot;Darwin&quot; ];
    cmake -DCMAKE_BUILD_TYPE=Release -G &quot;Xcode&quot; ../src
    xcodebuild -project &quot;LLVM.xcodeproj&quot;
  fi
  popd
fi

if ! test -d ${LLVM_TEST_DIR}; then
  mkdir ${LLVM_TEST_DIR}
  tar -xf llvm-${VERSION}.src.tar.xz -C ${LLVM_TEST_DIR}
  mv ${LLVM_TEST_DIR}/llvm-${VERSION}.src ${LLVM_TEST_DIR}/src
  cp -rf ../src/modify/src/* ${LLVM_TEST_DIR}/src/.
  cp -rf ../Cpu0 ${LLVM_TEST_DIR}/src/lib/Target/.
  mkdir ${LLVM_TEST_DIR}/cmake_debug_build
  pushd ${LLVM_TEST_DIR}/cmake_debug_build
  if [ &quot;$OS&quot; == &quot;Linux&quot; ]; then
    cmake -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_C_COMPILER=clang \
   -DCMAKE_BUILD_TYPE=Debug -DLLVM_TARGETS_TO_BUILD=Cpu0 -G &quot;Unix Makefiles&quot; \
   ../src
    make -j$procs -l$procs
  else [ &quot;$OS&quot; == &quot;Darwin&quot; ];
    cmake -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_C_COMPILER=clang \
    -DCMAKE_BUILD_TYPE=Debug -DLLVM_TARGETS_TO_BUILD=Cpu0 -G &quot;Xcode&quot; ../src
    xcodebuild -project &quot;LLVM.xcodeproj&quot;
  fi
  popd
fi
</pre></div>
</div>
<div class="section" id="setting-up-your-mac">
<h2><a class="toc-backref" href="#id19">Setting Up Your Mac</a><a class="headerlink" href="#setting-up-your-mac" title="Permalink to this headline">¶</a></h2>
<p>The Xcode include clang and llvm already. The following three sub-sections are
needless. List them just for readers who like to build clang and llvm with
cmake GUI interface.</p>
<div class="section" id="installing-xcode-and-cmake">
<h3><a class="toc-backref" href="#id20">Installing Xcode and cmake</a><a class="headerlink" href="#installing-xcode-and-cmake" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Fix centering for figure captions.</p>
</div>
<p>Install Xcode from the Mac App Store. Then install cmake, which can be found
here: <a class="footnote-reference" href="#cmake" id="id2">[3]</a>.
Before installing cmake, ensure you can install applications you download
from the Internet.
Open <span class="menuselection">System Preferences ‣ Security &amp; Privacy</span>. Click the
<strong>lock</strong> to make changes, and under &#8220;Allow applications downloaded from:&#8221; select
the radio button next to &#8220;Anywhere.&#8221; See <a class="reference internal" href="#install-f2"><span class="std std-numref">Fig. 34</span></a> below for an
illustration. You may want to revert this setting after installing cmake.</p>
<div class="figure align-center" id="id12">
<span id="install-f2"></span><img alt="_images/22.png" src="_images/22.png" />
<p class="caption"><span class="caption-number">Fig. 34 </span><span class="caption-text">Adjusting Mac OS X security settings to allow cmake installation.</span></p>
</div>
<p>Alternatively, you can mount the cmake .dmg image file you downloaded. Untar
the latest cmake for Darwin, copy the cmake /Applications/ and set PATH as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>114-43-208-90:cmake_release_build Jonathan$ cat ~/.profile
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/Applications/CMake.app/Contents/bin
</pre></div>
</div>
</div>
<div class="section" id="install-icarus-verilog-tool-on-imac">
<h3><a class="toc-backref" href="#id21">Install Icarus Verilog tool on iMac</a><a class="headerlink" href="#install-icarus-verilog-tool-on-imac" title="Permalink to this headline">¶</a></h3>
<p>Install Icarus Verilog tool by command <code class="docutils literal"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">icarus-verilog</span></code> as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>JonathantekiiMac:~ Jonathan$ brew install icarus-verilog
<span class="o">==</span>&gt; Downloading ftp://icarus.com/pub/eda/verilog/v0.9/verilog-0.9.5.tar.gz
<span class="c1">######################################################################## 100.0%</span>
<span class="c1">######################################################################## 100.0%</span>
<span class="o">==</span>&gt; ./configure --prefix<span class="o">=</span>/usr/local/Cellar/icarus-verilog/0.9.5
<span class="o">==</span>&gt; <span class="nv">make</span>
<span class="o">==</span>&gt; make <span class="nv">installdirs</span>
<span class="o">==</span>&gt; make install
/usr/local/Cellar/icarus-verilog/0.9.5: <span class="m">39</span> files, 12M, built in <span class="m">55</span> seconds
</pre></div>
</div>
</div>
<div class="section" id="install-other-tools-on-imac">
<h3><a class="toc-backref" href="#id22">Install other tools on iMac</a><a class="headerlink" href="#install-other-tools-on-imac" title="Permalink to this headline">¶</a></h3>
<p>These tools mentioned in this section is for coding and debug.
You can work even without these tools.
Files compare tools Kdiff3 came from web site <a class="footnote-reference" href="#kdiff3" id="id3">[7]</a>.
FileMerge is a part of Xcode, you can type FileMerge in Finder – Applications
as <a class="reference internal" href="#install-f11"><span class="std std-numref">Fig. 35</span></a> and drag it into the Dock as
<a class="reference internal" href="#install-f12"><span class="std std-numref">Fig. 36</span></a>.</p>
<div class="figure align-center" id="id13">
<span id="install-f11"></span><img alt="_images/111.png" src="_images/111.png" />
<p class="caption"><span class="caption-number">Fig. 35 </span><span class="caption-text">Type FileMerge in Finder – Applications</span></p>
</div>
<div class="figure align-center" id="id14">
<span id="install-f12"></span><img alt="_images/121.png" src="_images/121.png" />
<p class="caption"><span class="caption-number">Fig. 36 </span><span class="caption-text">Drag FileMege into the Dock</span></p>
</div>
<p>Download tool Graphviz for display llvm IR nodes in debugging,
<a class="footnote-reference" href="#graphviz-dm" id="id4">[8]</a>.
We choose mountainlion as <a class="reference internal" href="#install-f13"><span class="std std-numref">Fig. 37</span></a> since our iMac is Mountain
Lion.</p>
<div class="figure align-center" id="id15">
<span id="install-f13"></span><a class="reference internal image-reference" href="_images/131.png"><img alt="_images/131.png" src="_images/131.png" style="width: 944.8px; height: 590.4px;" /></a>
<p class="caption"><span class="caption-number">Fig. 37 </span><span class="caption-text">Download graphviz for llvm IR node display</span></p>
</div>
<p>After install Graphviz, please set the path to .profile.
For example, we install the Graphviz in directory
/Applications/Graphviz.app/Contents/MacOS/, so add this path to
/User/Jonathan/.profile as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-12-177:InputFiles Jonathan$ cat /Users/Jonathan/.profile
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/Applications/Xcode.app/Contents/bin:
/Applications/Graphviz.app/Contents/MacOS/:/Users/Jonathan/llvm/release/
cmake_release_build/Debug/bin
</pre></div>
</div>
<p>The Graphviz information for llvm is at section &#8220;SelectionDAG Instruction
Selection Process&#8221; &#8221; of &#8220;The LLVM Target-Independent Code Generator&#8221; here
<a class="footnote-reference" href="#isp" id="id5">[9]</a>  and at section &#8220;Viewing graphs while debugging code&#8221; of &#8220;LLVM
Programmer’s Manual&#8221; here <a class="footnote-reference" href="#vgwdc" id="id6">[10]</a>.
TextWrangler is for edit file with line number display and dump binary file
like the obj file, *.o, that will be generated in chapter of Generating object
files if you havn&#8217;t gobjdump available.
You can download from App Store.
To dump binary file, first, open the binary file, next, select menu
<strong>“File – Hex Front Document”</strong> as <a class="reference internal" href="#install-f14"><span class="std std-numref">Fig. 38</span></a>.
Then select <strong>“Front document&#8217;s file”</strong> as <a class="reference internal" href="#install-f15"><span class="std std-numref">Fig. 39</span></a>.</p>
<div class="figure align-center" id="id16">
<span id="install-f14"></span><img alt="_images/141.png" src="_images/141.png" />
<p class="caption"><span class="caption-number">Fig. 38 </span><span class="caption-text">Select Hex Dump menu</span></p>
</div>
<div class="figure align-center" id="id17">
<span id="install-f15"></span><img alt="_images/15.png" src="_images/15.png" />
<p class="caption"><span class="caption-number">Fig. 39 </span><span class="caption-text">Select Front document&#8217;s file in TextWrangler</span></p>
</div>
<p>Install binutils by command <code class="docutils literal"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">binutils</span></code> as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-77-214:~ Jonathan$ brew install <span class="nv">binutils</span>
<span class="o">==</span>&gt; Downloading http://ftpmirror.gnu.org/binutils/binutils-2.22.tar.gz
<span class="c1">######################################################################## 100.0%</span>
<span class="o">==</span>&gt; ./configure --program-prefix<span class="o">=</span>g --prefix<span class="o">=</span>/usr/local/Cellar/binutils/2.22
--infodir<span class="o">=</span>/usr/loca
<span class="o">==</span>&gt; <span class="nv">make</span>
<span class="o">==</span>&gt; make install
/usr/local/Cellar/binutils/2.22: <span class="m">90</span> files, 19M, built in 4.7 minutes
118-165-77-214:~ Jonathan$ ls /usr/local/Cellar/binutils/2.22
COPYING     README      lib
ChangeLog     bin       share
INSTALL_RECEIPT.json    include       x86_64-apple-darwin12.2.0
118-165-77-214:binutils-2.23 Jonathan$ ls /usr/local/Cellar/binutils/2.22/bin
gaddr2line  gc++filt  gnm   gobjdump  greadelf  gstrings
gar   gelfedit  gobjcopy  granlib gsize   gstrip
</pre></div>
</div>
</div>
<div class="section" id="installing-clang">
<h3><a class="toc-backref" href="#id23">Installing clang</a><a class="headerlink" href="#installing-clang" title="Permalink to this headline">¶</a></h3>
<p>Xcode include clang execution file to compile code already, but if the version
of Xcode&#8217;s clang is not as new as the llvm we want to install later, then we
need to install and build the clang with llvm as this sub-section.</p>
<p>Please download LLVM latest release version 3.7 (llvm, clang) from
the &#8220;LLVM Download Page&#8221; <a class="footnote-reference" href="#llvm-download" id="id7">[2]</a>. Then extract them using
<code class="docutils literal"><span class="pre">tar</span> <span class="pre">-xvf</span> <span class="pre">{llvm-3.7.0.src.tar.xz,</span> <span class="pre">cfe-3.7.0.src.tar.xz}</span></code>,
and change the llvm source code root directory into src.
After that, move the clang source code to src/tools/clang as shown as follows.
The compiler-rt should not installed in iMac OS X 10.9 and Xcode 5.x. If you
did as clang installation web document, it will has compiler error.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-78-111:Downloads Jonathan$ tar -xvf cfe-3.7.0.src.tar.xz
118-165-78-111:Downloads Jonathan$ tar -xvf llvm-3.7.0.src.tar.xz
118-165-78-111:Downloads Jonathan$ mv llvm-3.7.0.src src
118-165-78-111:Downloads Jonathan$ mv cfe-3.7.0.src src/tools/clang
118-165-78-111:Downloads Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/Downloads
118-165-78-111:Downloads Jonathan$ ls
cfe-3.7.0.src.tar.xz        llvm-3.7.0.src.tar.xz
src
118-165-78-111:Downloads Jonathan$ ls src/tools/
CMakeLists.txt  clang       llvm-as         llvm-dis        llvm-mcmarkup
llvm-readobj    llvm-stub   LLVMBuild.txt   gold            llvm-bcanalyzer
llvm-dwarfdump  llvm-nm     llvm-rtdyld     lto             Makefile
llc             llvm-config llvm-extract    llvm-objdump    llvm-shlib
macho-dump      bugpoint    lli             llvm-cov        llvm-link
llvm-prof       llvm-size   opt             bugpoint-passes llvm-ar
llvm-diff       llvm-mc     llvm-ranlib     llvm-stress
</pre></div>
</div>
<p>Next, copy the LLVM source to /Users/Jonathan/llvm/release/src by executing the
terminal command
<code class="docutils literal"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">/Users/Jonathan/Downloads/src</span> <span class="pre">/Users/Jonathan/llvm/release/.</span></code>.</p>
</div>
<div class="section" id="create-llvm-xcodeproj-by-terminal-cmake-command">
<h3><a class="toc-backref" href="#id24">Create LLVM.xcodeproj by terminal cmake command</a><a class="headerlink" href="#create-llvm-xcodeproj-by-terminal-cmake-command" title="Permalink to this headline">¶</a></h3>
<p>We installed llvm source code with clang on directory
/Users/Jonathan/llvm/release/ in last section.
Now, will generate the LLVM.xcodeproj in this chapter.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>114-43-213-176:release Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/llvm/release
114-43-213-176:release Jonathan$ mkdir cmake_release_build
114-43-213-176:release Jonathan$ <span class="nb">cd</span> cmake_release_build
114-43-213-176:cmake_release_build Jonathan$ cmake -DCMAKE_CXX_COMPILER<span class="o">=</span>clang++
-DCMAKE_C_COMPILER<span class="o">=</span>clang -DCMAKE_CXX_FLAGS<span class="o">=</span>-std<span class="o">=</span>c++11 -DCMAKE_BUILD_TYPE<span class="o">=</span>Debug
-G <span class="s2">&quot;Xcode&quot;</span> ../src
...
114-43-213-176:cmake_release_build Jonathan$ ls
... LLVM.xcodeproj
</pre></div>
</div>
</div>
<div class="section" id="build-llvm-by-xcode">
<h3><a class="toc-backref" href="#id25">Build llvm by Xcode</a><a class="headerlink" href="#build-llvm-by-xcode" title="Permalink to this headline">¶</a></h3>
<p>Now, LLVM.xcodeproj is created. Open the cmake_release_build/LLVM.xcodeproj by
Xcode and click menu <strong>“Product – Build”</strong> as <a class="reference internal" href="#install-f10"><span class="std std-numref">Fig. 40</span></a>.</p>
<div class="figure align-center" id="id18">
<span id="install-f10"></span><img alt="_images/102.png" src="_images/102.png" />
<p class="caption"><span class="caption-number">Fig. 40 </span><span class="caption-text">Click Build button to build LLVM.xcodeproj by Xcode</span></p>
</div>
<p>After few minutes of build, the clang, llc, llvm-as, ..., can be found in
cmake_release_build/Debug/bin/ as follows.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-78-111:cmake_release_build Jonathan$ <span class="nb">cd</span> Debug/bin/
118-165-78-111:bin Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/llvm/release/cmake_release_build/Debug/bin
118-165-78-111:bin Jonathan$ ls
...
clang
...
llc
...
llvm-as
...
</pre></div>
</div>
<p>To access those execution files, edit .profile (if you .profile not exists,
please create file .profile), save .profile to /Users/Jonathan/, and enable
$PATH by command <code class="docutils literal"><span class="pre">source</span> <span class="pre">.profile</span></code> as follows.
Please add path /Applications//Xcode.app/Contents/Developer/usr/bin to .profile
if you didn&#8217;t add it after Xcode download.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-65-128:~ Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan
118-165-65-128:~ Jonathan$ cat .profile
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/Applications/Xcode.app/Contents/Developer/usr/bin:/Applicatio
ns/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/:/Ap
plications/Graphviz.app/Contents/MacOS/:/Users/Jonathan/llvm/release/cmake_relea
se_build/Debug/bin
<span class="nb">export</span> <span class="nv">WORKON_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/.virtualenvs
<span class="nb">source</span> /usr/local/bin/virtualenvwrapper.sh <span class="c1"># where Homebrew places it</span>
<span class="nb">export</span> <span class="nv">VIRTUALENVWRAPPER_VIRTUALENV_ARGS</span><span class="o">=</span><span class="s1">&#39;--no-site-packages&#39;</span> <span class="c1"># optional</span>
118-165-65-128:~ Jonathan$
</pre></div>
</div>
</div>
<div class="section" id="create-llvm-xcodeproj-of-supporting-cpu0-by-terminal-cmake-command">
<h3><a class="toc-backref" href="#id26">Create LLVM.xcodeproj of supporting Cpu0 by terminal cmake command</a><a class="headerlink" href="#create-llvm-xcodeproj-of-supporting-cpu0-by-terminal-cmake-command" title="Permalink to this headline">¶</a></h3>
<p>We have installed llvm with clang on directory llvm/release/.
Now, we want to install llvm with our cpu0 backend code on directory
llvm/test/ in this section.</p>
<p>This book is on the process of merging into llvm trunk but not finished
yet.
The merged llvm trunk version on lbd git hub is LLVM 3.7 released version.
The lbd of Cpu0 example code is also based on llvm 3.7.
So, please install the llvm 3.7 debug version as the llvm release 3.7
installation, but without clang since the clang will waste time in build the
Cpu0 backend tutorial code.
Steps as follows,</p>
<p>The details of installing Cpu0 backend example code as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-78-111:llvm Jonathan$ mkdir <span class="nb">test</span>
118-165-78-111:llvm Jonathan$ <span class="nb">cd</span> <span class="nb">test</span>
118-165-78-111:test Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/llvm/test
118-165-78-111:test Jonathan$ cp /Users/Jonathan/Downloads/llvm-3.7.0.src.tar.xz .
118-165-78-111:test Jonathan$ tar -xvf llvm-3.7.0.src.tar.xz
118-165-78-111:test Jonathan$ mv llvm-3.7.0.src src
118-165-78-111:test Jonathan$ cp /Users/Jonathan/Downloads/
lbdex.tar.gz .
118-165-78-111:test Jonathan$ tar -zxvf lbdex.tar.gz
118-165-78-111:test Jonathan$ cp -rf lbdex/src/modify/src/* src/.
118-165-78-111:test Jonathan$ grep -R <span class="s2">&quot;Cpu0&quot;</span> src/include
...
src/include/llvm/MC/MCExpr.h:    VK_Cpu0_GPREL,
src/include/llvm/MC/MCExpr.h:    VK_Cpu0_GOT_CALL,
src/include/llvm/MC/MCExpr.h:    VK_Cpu0_GOT16,
src/include/llvm/MC/MCExpr.h:    VK_Cpu0_GOT,
src/include/llvm/MC/MCExpr.h:    VK_Cpu0_ABS_HI,
src/include/llvm/MC/MCExpr.h:    VK_Cpu0_ABS_LO,
...
src/lib/MC/MCExpr.cpp:  <span class="k">case</span> VK_Cpu0_GOT_PAGE: <span class="k">return</span> <span class="s2">&quot;GOT_PAGE&quot;</span><span class="p">;</span>
src/lib/MC/MCExpr.cpp:  <span class="k">case</span> VK_Cpu0_GOT_OFST: <span class="k">return</span> <span class="s2">&quot;GOT_OFST&quot;</span><span class="p">;</span>
src/lib/Target/LLVMBuild.txt:subdirectories <span class="o">=</span> ARM CellSPU CppBackend Hexagon
MBlaze MSP430 NVPTX Mips Cpu0 PowerPC Sparc X86 XCore
118-165-78-111:test Jonathan$
</pre></div>
</div>
<p>Next, please copy Cpu0 example code according the following commands,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-78-111:test Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/llvm/test
118-165-78-111:test Jonathan$ cp -rf lbdex/Cpu0 src/lib/Target/.
118-165-78-111:test Jonathan$ ls src/lib/Target/Cpu0
CMakeLists.txt                Cpu0InstrInfo.td        Cpu0TargetMachine.cpp   TargetInfo
Cpu0.h                        Cpu0RegisterInfo.td     ExampleCode             readme
Cpu0.td                       Cpu0Schedule.td         LLVMBuild.txt
Cpu0InstrFormats.td   Cpu0Subtarget.h         MCTargetDesc
118-165-80-55:Cpu0 Jonathan$
</pre></div>
</div>
<p>Now, it&#8217;s ready for building llvm/test/src code by command <code class="docutils literal"><span class="pre">cmake</span></code> as follows.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-78-111:test Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/llvm/test
118-165-78-111:test Jonathan$ ls
src
118-165-78-111:test Jonathan$ mkdir cmake_debug_build
118-165-78-111:test Jonathan$ <span class="nb">cd</span> cmake_debug_build/
118-165-78-111:cmake_debug_build Jonathan$ cmake -DCMAKE_CXX_COMPILER<span class="o">=</span>clang++
-DCMAKE_C_COMPILER<span class="o">=</span>clang -DCMAKE_BUILD_TYPE<span class="o">=</span>Debug -DLLVM_TARGETS_TO_BUILD<span class="o">=</span>Cpu0
-G <span class="s2">&quot;Xcode&quot;</span> ../src/
-- The C compiler identification is Clang 5.0
-- The CXX compiler identification is Clang 5.0
-- Check <span class="k">for</span> working C compiler using: Xcode
...
-- Targeting Cpu0
...
-- Performing Test SUPPORTS_GLINE_TABLES_ONLY_FLAG
-- Performing Test SUPPORTS_GLINE_TABLES_ONLY_FLAG - Success
-- Performing Test SUPPORTS_NO_C99_EXTENSIONS_FLAG
-- Performing Test SUPPORTS_NO_C99_EXTENSIONS_FLAG - Success
-- Configuring <span class="k">done</span>
-- Generating <span class="k">done</span>
-- Build files have been written to: /Users/Jonathan/llvm/test/cmake_debug_build
118-165-78-111:cmake_debug_build Jonathan$
</pre></div>
</div>
<p>Now, you can build this llvm build with Cpu0 backend only by Xcode.</p>
<p>On iMac, tt also can do cmake and make with <code class="docutils literal"><span class="pre">`cmake</span> <span class="pre">-G</span> <span class="pre">&quot;Unix</span> <span class="pre">Makefiles&quot;</span></code> same
as the Linux as the following section.</p>
<p>Since Xcode use clang compiler and lldb instead of gcc and gdb, we can run lldb
debug as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>118-165-65-128:InputFiles Jonathan$ <span class="nb">pwd</span>
/Users/Jonathan/lbdex/InputFiles
118-165-65-128:InputFiles Jonathan$ clang -c ch3.cpp -emit-llvm -o ch3.bc
118-165-65-128:InputFiles Jonathan$ /Users/Jonathan/llvm/test/
cmake_debug_build/Debug/bin/llc -march<span class="o">=</span>mips -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>asm
ch3.bc -o ch3.mips.s
118-165-65-128:InputFiles Jonathan$ lldb -- /Users/Jonathan/llvm/test/
cmake_debug_build/Debug/bin/llc -march<span class="o">=</span>mips -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>
asm ch3.bc -o ch3.mips.s
Current executable <span class="nb">set</span> to <span class="s1">&#39;/Users/Jonathan/llvm/test/cmake_debug_build/bin/</span>
<span class="s1">Debug/llc&#39;</span> <span class="o">(</span>x86_64<span class="o">)</span>.
<span class="o">(</span>lldb<span class="o">)</span> b MipsTargetInfo.cpp:19
breakpoint <span class="nb">set</span> --file <span class="s1">&#39;MipsTargetInfo.cpp&#39;</span> --line 19
Breakpoint created: 1: <span class="nv">file</span> <span class="o">=</span><span class="s1">&#39;MipsTargetInfo.cpp&#39;</span>, <span class="nv">line</span> <span class="o">=</span> 19, <span class="nv">locations</span> <span class="o">=</span> 1
<span class="o">(</span>lldb<span class="o">)</span> run
Process <span class="m">6058</span> launched: <span class="s1">&#39;/Users/Jonathan/llvm/test/cmake_debug_build/Debug/bin/</span>
<span class="s1">llc&#39;</span> <span class="o">(</span>x86_64<span class="o">)</span>
Process <span class="m">6058</span> stopped
* thread <span class="c1">#1: tid = 0x1c03, 0x000000010077f231 llc`LLVMInitializeMipsTargetInfo</span>
+ <span class="m">33</span> at MipsTargetInfo.cpp:20, stop <span class="nv">reason</span> <span class="o">=</span> breakpoint 1.1
  frame <span class="c1">#0: 0x000000010077f231 llc`LLVMInitializeMipsTargetInfo + 33 at</span>
  MipsTargetInfo.cpp:20
   17
   <span class="m">18</span>   extern <span class="s2">&quot;C&quot;</span> void LLVMInitializeMipsTargetInfo<span class="o">()</span> <span class="o">{</span>
   <span class="m">19</span>     RegisterTarget&lt;Triple::mips,
-&gt; <span class="m">20</span>           /*HasJIT<span class="o">=</span>*/true&gt; X<span class="o">(</span>TheMipsTarget, <span class="s2">&quot;mips&quot;</span>, <span class="s2">&quot;Mips&quot;</span><span class="o">)</span><span class="p">;</span>
   21
   <span class="m">22</span>     RegisterTarget&lt;Triple::mipsel,
   <span class="m">23</span>           /*HasJIT<span class="o">=</span>*/true&gt; Y<span class="o">(</span>TheMipselTarget, <span class="s2">&quot;mipsel&quot;</span>, <span class="s2">&quot;Mipsel&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">(</span>lldb<span class="o">)</span> n
Process <span class="m">6058</span> stopped
* thread <span class="c1">#1: tid = 0x1c03, 0x000000010077f24f llc`LLVMInitializeMipsTargetInfo</span>
+ <span class="m">63</span> at MipsTargetInfo.cpp:23, stop <span class="nv">reason</span> <span class="o">=</span> step over
  frame <span class="c1">#0: 0x000000010077f24f llc`LLVMInitializeMipsTargetInfo + 63 at</span>
  MipsTargetInfo.cpp:23
   <span class="m">20</span>           /*HasJIT<span class="o">=</span>*/true&gt; X<span class="o">(</span>TheMipsTarget, <span class="s2">&quot;mips&quot;</span>, <span class="s2">&quot;Mips&quot;</span><span class="o">)</span><span class="p">;</span>
   21
   <span class="m">22</span>     RegisterTarget&lt;Triple::mipsel,
-&gt; <span class="m">23</span>           /*HasJIT<span class="o">=</span>*/true&gt; Y<span class="o">(</span>TheMipselTarget, <span class="s2">&quot;mipsel&quot;</span>, <span class="s2">&quot;Mipsel&quot;</span><span class="o">)</span><span class="p">;</span>
   24
   <span class="m">25</span>     RegisterTarget&lt;Triple::mips64,
   <span class="m">26</span>           /*HasJIT<span class="o">=</span>*/false&gt; A<span class="o">(</span>TheMips64Target, <span class="s2">&quot;mips64&quot;</span>, <span class="s2">&quot;Mips64</span>
<span class="s2">   [experimental]&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">(</span>lldb<span class="o">)</span> print X
<span class="o">(</span>llvm::RegisterTarget&lt;llvm::Triple::ArchType, true&gt;<span class="o">)</span> <span class="nv">$0</span> <span class="o">=</span> <span class="o">{}</span>
<span class="o">(</span>lldb<span class="o">)</span> quit
118-165-65-128:InputFiles Jonathan$
</pre></div>
</div>
<p>About the lldb debug command, please reference <a class="footnote-reference" href="#lldb-gdb" id="id8">[4]</a> or lldb portal
<a class="footnote-reference" href="#lldb" id="id9">[5]</a>.</p>
</div>
</div>
<div class="section" id="setting-up-your-linux-machine">
<h2><a class="toc-backref" href="#id27">Setting Up Your Linux Machine</a><a class="headerlink" href="#setting-up-your-linux-machine" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-icarus-verilog-tool-on-linux">
<h3><a class="toc-backref" href="#id28">Install Icarus Verilog tool on Linux</a><a class="headerlink" href="#install-icarus-verilog-tool-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Download the snapshot version of Icarus Verilog tool from web site,
<a class="reference external" href="ftp://icarus.com/pub/eda/verilog/snapshots">ftp://icarus.com/pub/eda/verilog/snapshots</a> or go to <a class="reference external" href="http://iverilog.icarus.com/">http://iverilog.icarus.com/</a>
and click snapshot version link. Follow the INSTALL file guide to install it.</p>
</div>
<div class="section" id="install-other-tools-on-linux">
<h3><a class="toc-backref" href="#id29">Install other tools on Linux</a><a class="headerlink" href="#install-other-tools-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Download Graphviz from <a class="footnote-reference" href="#graphviz-download" id="id10">[11]</a> according your
Linux distribution. Files compare tools Kdiff3 came from web site <a class="footnote-reference" href="#kdiff3" id="id11">[7]</a>.</p>
</div>
<div class="section" id="install-llvm-3-7-release-build-on-linux">
<h3><a class="toc-backref" href="#id30">Install LLVM 3.7 release build on Linux</a><a class="headerlink" href="#install-llvm-3-7-release-build-on-linux" title="Permalink to this headline">¶</a></h3>
<p>First, install the llvm release build by,</p>
<blockquote>
<div><ol class="arabic simple">
<li>Untar llvm source, rename llvm source with src.</li>
<li>Untar clang and move it src/tools/clang.</li>
</ol>
</div></blockquote>
<p>Next, build with cmake command, <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">-DCMAKE_BUILD_TYPE=Release</span> <span class="pre">-DCLANG_BUILD</span>
<span class="pre">_EXAMPLES=ON</span> <span class="pre">-DLLVM_BUILD_EXAMPLES=ON</span> <span class="pre">-G</span> <span class="pre">&quot;Unix</span> <span class="pre">Makefiles&quot;</span> <span class="pre">../src/</span></code>, as follows.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost cmake_release_build<span class="o">]</span>$ <span class="nb">pwd</span>
/home/cschen/llvm/release/cmake_release_build
<span class="o">[</span>Gamma@localhost cmake_release_build<span class="o">]</span>$ cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Release
-DCLANG_BUILD_EXAMPLES<span class="o">=</span>ON -DLLVM_BUILD_EXAMPLES<span class="o">=</span>ON -G <span class="s2">&quot;Unix Makefiles&quot;</span> ../src/
-- The C compiler identification is GNU 4.8.2
...
-- Constructing LLVMBuild project information
...
-- Targeting XCore
-- Clang version: 3.7
-- Found Subversion: /usr/bin/svn <span class="o">(</span>found version <span class="s2">&quot;1.7.6&quot;</span><span class="o">)</span>
-- Configuring <span class="k">done</span>
-- Generating <span class="k">done</span>
-- Build files have been written to: /home/cschen/llvm/release/cmake_release_build
</pre></div>
</div>
<p>After cmake, run command <code class="docutils literal"><span class="pre">make</span></code>, then you can get clang, llc, llvm-as, ...,
in cmake_release_build/bin/ after a few tens minutes of build.
To speed up make process via SMP power, please check your core numbers by the
following command then do make the next.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost cmake_release_build<span class="o">]</span>$ cat /proc/cpuinfo <span class="p">|</span> grep processor <span class="p">|</span> wc -l
8
<span class="o">[</span>Gamma@localhost cmake_release_build<span class="o">]</span>$ make -j8 -l8
</pre></div>
</div>
<p>Next, edit
/home/Gamma/.bash_profile with adding /home/cschen/llvm/release/cmake_release_build/
bin to PATH to enable the clang, llc, ..., command search path, as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost ~<span class="o">]</span>$ <span class="nb">pwd</span>
/home/Gamma
<span class="o">[</span>Gamma@localhost ~<span class="o">]</span>$ cat .bash_profile
<span class="c1"># .bash_profile</span>

<span class="c1"># Get the aliases and functions</span>
<span class="k">if</span> <span class="o">[</span> -f ~/.bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  . ~/.bashrc
<span class="k">fi</span>

<span class="c1"># User specific environment and startup programs</span>

<span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/sphinx/bin:~/llvm/release/cmake_release_build/bin:
/opt/mips_linux_toolchain_clang/mips_linux_toolchain/bin:<span class="nv">$HOME</span>/.local/bin:
<span class="nv">$HOME</span>/bin

<span class="nb">export</span> PATH
<span class="o">[</span>Gamma@localhost ~<span class="o">]</span>$ <span class="nb">source</span> .bash_profile
<span class="o">[</span>Gamma@localhost ~<span class="o">]</span>$ <span class="nv">$PATH</span>
bash: /usr/lib64/qt-3.3/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:
/usr/sbin:/usr/local/sphinx/bin:/home/Gamma/.local/bin:/home/Gamma/bin:
/usr/local/sphinx/bin:/home/cschen/llvm/release/cmake_release_build/bin
</pre></div>
</div>
</div>
<div class="section" id="install-cpu0-debug-build-on-linux">
<h3><a class="toc-backref" href="#id31">Install Cpu0 debug build on Linux</a><a class="headerlink" href="#install-cpu0-debug-build-on-linux" title="Permalink to this headline">¶</a></h3>
<p>This book is on the process of merging into llvm trunk but not finished
yet.
The merged llvm trunk version on lbd git hub is LLVM 3.7 released version.
The Cpu0 example code is also based on llvm 3.7.
So, please install the llvm 3.7 debug version as the llvm release 3.7
installation, but without clang since the clang will waste time in build the
Cpu0 backend tutorial code.
Steps as follows,</p>
<p>The details of installing Cpu0 backend example code according the following
list steps, and the corresponding commands shown as below,</p>
<ol class="arabic simple">
<li>Enter ~/llvm/test/ and
get Cpu0 example code as well as the llvm 3.7.</li>
<li>Make dir Cpu0 in src/lib/Target and download example code.</li>
<li>Update llvm modified source files to support cpu0 by command
<code class="docutils literal"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">lbdex/src/modify/src/*</span> <span class="pre">src/.</span></code>.</li>
<li>Check step 3 is effective by command ,
<code class="docutils literal"><span class="pre">grep</span> <span class="pre">-R</span> <span class="pre">&quot;Cpu0&quot;</span> <span class="pre">.</span> <span class="pre">|</span> <span class="pre">more`</span></code>. We add the Cpu0 backend support, so check with
grep.</li>
<li>Copy Cpu0 bakend code by command,
<code class="docutils literal"><span class="pre">cp</span> <span class="pre">-rf</span> <span class="pre">lbdex/Cpu0</span> <span class="pre">src/lib/Target/.</span></code>.</li>
<li>Remove clang from ~/llvm/test/src/tools/clang, and mkdir
test/cmake_debug_build. Otherwise you will waste extra time for
command <code class="docutils literal"><span class="pre">make</span></code> in Cpu0 example code build with clang.</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost llvm<span class="o">]</span>$ mkdir <span class="nb">test</span>
<span class="o">[</span>Gamma@localhost llvm<span class="o">]</span>$ <span class="nb">cd</span> <span class="nb">test</span>
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ <span class="nb">pwd</span>
/home/cschen/llvm/test
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ cp /home/Gamma/Downloads/llvm-3.7.0.src.tar.xz .
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ tar -xvf llvm-3.7.0.src.tar.xz
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ mv llvm-3.7.0.src src
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ cp /Users/Jonathan/Downloads/
lbdex.tar.gz .
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ tar -zxvf lbdex.tar.gz
...
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ cp -rf lbdex/src/modify/src/* src/.
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ grep -R <span class="s2">&quot;cpu0&quot;</span> src/include
src/include//llvm/ADT/Triple.h:    cpu0,    // For Tutorial Backend Cpu0
src/include//llvm/MC/MCExpr.h:    VK_Cpu0_GPREL,
src/include//llvm/MC/MCExpr.h:    VK_Cpu0_GOT_CALL,
...
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ cp -rf lbdex/Cpu0 src/lib/Target/.
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ ls src/lib/Target/Cpu0
AsmParser                 Cpu0RegisterInfoGPROutForAsm.td
CMakeLists.txt            Cpu0RegisterInfoGPROutForOther.td
...
</pre></div>
</div>
<p>Now, create directory cmake_debug_build and do cmake just like build the
llvm/release, except we do Debug build with Cpu0 backend only, and use clang as
our compiler instead, as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ <span class="nb">pwd</span>
/home/cschen/llvm/test
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ mkdir cmake_debug_build
<span class="o">[</span>Gamma@localhost test<span class="o">]</span>$ <span class="nb">cd</span> cmake_debug_build/
<span class="o">[</span>Gamma@localhost cmake_debug_build<span class="o">]</span>$ cmake -DCMAKE_CXX_COMPILER<span class="o">=</span>clang++
-DCMAKE_C_COMPILER<span class="o">=</span>clang -DCMAKE_BUILD_TYPE<span class="o">=</span>Debug -DLLVM_TARGETS_TO_BUILD<span class="o">=</span>Cpu0
-G <span class="s2">&quot;Unix Makefiles&quot;</span> ../src/
-- The C compiler identification is Clang 3.7.0
-- The CXX compiler identification is Clang 3.7.0
-- Check <span class="k">for</span> working C compiler: /home/cschen/llvm/release/cmake_release_build/bin/
clang
-- Check <span class="k">for</span> working C compiler: /home/cschen/llvm/release/cmake_release_build/bin/
clang
 -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="k">done</span>
-- Check <span class="k">for</span> working CXX compiler: /home/cschen/llvm/release/cmake_release_build/
bin/clang++
-- Check <span class="k">for</span> working CXX compiler: /home/cschen/llvm/release/cmake_release_build/
bin/clang++
 -- works
...
-- Targeting Mips
-- Targeting Cpu0
...
-- Configuring <span class="k">done</span>
-- Generating <span class="k">done</span>
-- Build files have been written to: /home/cschen/llvm/test/cmake_debug
_build
<span class="o">[</span>Gamma@localhost cmake_debug_build<span class="o">]</span>$
</pre></div>
</div>
<p>Then do make as follows,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost cmake_debug_build<span class="o">]</span>$ make -j8 -l8
Scanning dependencies of target LLVMSupport
<span class="o">[</span> 0%<span class="o">]</span> Building CXX object lib/Support/CMakeFiles/LLVMSupport.dir/APFloat.cpp.o
<span class="o">[</span> 0%<span class="o">]</span> Building CXX object lib/Support/CMakeFiles/LLVMSupport.dir/APInt.cpp.o
<span class="o">[</span> 0%<span class="o">]</span> Building CXX object lib/Support/CMakeFiles/LLVMSupport.dir/APSInt.cpp.o
<span class="o">[</span> 0%<span class="o">]</span> Building CXX object lib/Support/CMakeFiles/LLVMSupport.dir/Allocator.cpp.o
<span class="o">[</span> 1%<span class="o">]</span> Building CXX object lib/Support/CMakeFiles/LLVMSupport.dir/BlockFrequency.
cpp.o ...
Linking CXX static library ../../lib/libgtest.a
<span class="o">[</span>100%<span class="o">]</span> Built target gtest
Scanning dependencies of target gtest_main
<span class="o">[</span>100%<span class="o">]</span> Building CXX object utils/unittest/CMakeFiles/gtest_main.dir/UnitTestMain
/
TestMain.cpp.o Linking CXX static library ../../lib/libgtest_main.a
<span class="o">[</span>100%<span class="o">]</span> Built target gtest_main
<span class="o">[</span>Gamma@localhost cmake_debug_build<span class="o">]</span>$
</pre></div>
</div>
<p>Since clang invoke the ~/llvm/cmake_release_build/bin/clang where
is built by <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">-DCMAKE_BUILD_TYPE=Release</span></code>, it is 4 times speed up more
than <code class="docutils literal"><span class="pre">make</span></code> (default use 1 thread only). But if you make with debug
clang build, it won&#8217;t speed up too much.</p>
<p>Now, we are ready for the cpu0 backend development. We can run gdb debug
as follows.
If your setting has anything about gdb errors, please follow the errors
indication (maybe need to download gdb again).
Finally, try gdb as follows.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>Gamma@localhost InputFiles<span class="o">]</span>$ <span class="nb">pwd</span>
~/llvm/test/src/lib/Target/Cpu0/ExampleCode/
lbdex/InputFiles
<span class="o">[</span>Gamma@localhost InputFiles<span class="o">]</span>$ clang -c ch3.cpp -emit-llvm -o ch3.bc
<span class="o">[</span>Gamma@localhost InputFiles<span class="o">]</span>$ gdb -args ~/llvm/test/
cmake_debug_build/bin/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj
ch3.bc -o ch3.cpu0.o
GNU gdb <span class="o">(</span>GDB<span class="o">)</span> Fedora <span class="o">(</span>7.4.50.20120120-50.fc17<span class="o">)</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2012</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
This GDB was configured as <span class="s2">&quot;x86_64-redhat-linux-gnu&quot;</span>.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /home/cschen/llvm/test/cmake_debug_build/bin/llc.
..done.
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break</span> MipsTargetInfo.cpp:19
Breakpoint <span class="m">1</span> at 0xd54441: file /home/cschen/llvm/test/src/lib/Target/
Mips/TargetInfo/MipsTargetInfo.cpp, line 19.
<span class="o">(</span>gdb<span class="o">)</span> run
Starting program: /home/cschen/llvm/test/cmake_debug_build/bin/llc
-march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj ch3.bc -o ch3.cpu0.o
<span class="o">[</span>Thread debugging using libthread_db enabled<span class="o">]</span>
Using host libthread_db library <span class="s2">&quot;/lib64/libthread_db.so.1&quot;</span>.

Breakpoint 1, LLVMInitializeMipsTargetInfo <span class="o">()</span>
  at /home/cschen/llvm/test/src/lib/Target/Mips/TargetInfo/MipsTargetInfo.cpp:20
<span class="m">20</span>          /*HasJIT<span class="o">=</span>*/true&gt; X<span class="o">(</span>TheMipsTarget, <span class="s2">&quot;mips&quot;</span>, <span class="s2">&quot;Mips&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">(</span>gdb<span class="o">)</span> next
<span class="m">23</span>          /*HasJIT<span class="o">=</span>*/true&gt; Y<span class="o">(</span>TheMipselTarget, <span class="s2">&quot;mipsel&quot;</span>, <span class="s2">&quot;Mipsel&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">(</span>gdb<span class="o">)</span> print X
<span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span>&lt;No data fields&gt;<span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> quit
A debugging session is active.

  Inferior <span class="m">1</span> <span class="o">[</span>process 10165<span class="o">]</span> will be killed.

Quit anyway? <span class="o">(</span>y or n<span class="o">)</span> y
<span class="o">[</span>Gamma@localhost InputFiles<span class="o">]</span>$
</pre></div>
</div>
<table class="docutils footnote" frame="void" id="llvm-cmake" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://llvm.org/docs/CMake.html?highlight=cmake">http://llvm.org/docs/CMake.html?highlight=cmake</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="llvm-download" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[2]</a></td><td><a class="reference external" href="http://llvm.org/releases/download.html#3.7">http://llvm.org/releases/download.html#3.7</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="cmake" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[3]</a></td><td><a class="reference external" href="http://www.cmake.org/cmake/resources/software.html">http://www.cmake.org/cmake/resources/software.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lldb-gdb" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[4]</a></td><td><a class="reference external" href="http://lldb.llvm.org/lldb-gdb.html">http://lldb.llvm.org/lldb-gdb.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lldb" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[5]</a></td><td><a class="reference external" href="http://lldb.llvm.org/">http://lldb.llvm.org/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="test" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><a class="reference external" href="http://llvm.org/docs/TestingGuide.html">http://llvm.org/docs/TestingGuide.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="kdiff3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id11">2</a>)</em> <a class="reference external" href="http://kdiff3.sourceforge.net">http://kdiff3.sourceforge.net</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="graphviz-dm" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[8]</a></td><td><a class="reference external" href="http://www.graphviz.org/Download_macos.php">http://www.graphviz.org/Download_macos.php</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="isp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[9]</a></td><td><a class="reference external" href="http://llvm.org/docs/CodeGenerator.html#selectiondag-instruction-selection-process">http://llvm.org/docs/CodeGenerator.html#selectiondag-instruction-selection-process</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vgwdc" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[10]</a></td><td><a class="reference external" href="http://llvm.org/docs/ProgrammersManual.html#viewing-graphs-while-debugging-code">http://llvm.org/docs/ProgrammersManual.html#viewing-graphs-while-debugging-code</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="graphviz-download" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[11]</a></td><td><a class="reference external" href="http://www.graphviz.org/Download.php">http://www.graphviz.org/Download.php</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="verilog.html">Verify backend on Verilog simulator</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="doc.html">Appendix B: Cpu0 document and test</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Chen Chung-Shu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
  </body>
</html>